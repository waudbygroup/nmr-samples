<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NMR Sample Manager</title>
    <link rel="stylesheet" href="css/styles.css">
    <!-- Bootstrap and React JSON Schema Form - reliable working version -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script crossorigin src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/react-jsonschema-form@1.8.1/dist/react-jsonschema-form.js"></script>
</head>
<body>
    <div id="app">
        <div class="app-container">
            <header class="app-header">
                <h1>NMR Sample Manager</h1>
            </header>
            
            <div class="main-content">
                <!-- Left Sidebar -->
                <aside class="sidebar">
                    <!-- Folder Selection -->
                    <!-- Directory Selection -->
                    <div class="folder-section">
                        <h3>Directories</h3>
                        <div class="directory-grid">
                            <div class="directory-row">
                                <span class="directory-label">Root:</span>
                                <span id="root-folder" class="directory-path">No root directory set</span>
                                <button id="set-root-folder" class="btn btn-primary btn-sm">Set</button>
                            </div>
                            <div class="directory-row">
                                <span class="directory-label">Experiment:</span>
                                <span id="current-folder" class="directory-path">No folder selected</span>
                                <button id="browse-subfolder" class="btn btn-info btn-sm">Browse</button>
                            </div>
                        </div>
                        <div class="timeline-section">
                            <button id="show-timeline" class="btn btn-timeline btn-sm" disabled>Show timeline</button>
                        </div>
                    </div>

                    <!-- Sample List -->
                    <div class="sample-list-section">
                        <h3>Samples</h3>
                        <div id="sample-list" class="sample-list">
                            <p class="placeholder">Select a folder to see samples</p>
                        </div>
                        
                        <!-- Sample Actions -->
                        <div class="sample-actions">
                            <button id="new-sample" class="btn btn-success btn-sm">New Sample</button>
                            <button id="duplicate-sample" class="btn btn-info btn-sm" disabled>Duplicate</button>
                            <button id="edit-sample" class="btn btn-warning btn-sm" disabled>Edit</button>
                            <button id="eject-sample" class="btn btn-danger btn-sm" disabled>Eject</button>
                        </div>
                    </div>
                </aside>

                <!-- Main Content Area -->
                <main class="content-area">
                    <div id="sample-form" class="content-body">
                        <div class="welcome-message">
                            <h3>Welcome to NMR Sample Manager</h3>
                            <p>Select a folder and choose a sample to view its details, or create a new sample to get started.</p>
                        </div>
                    </div>
                </main>
            </div>
        </div>
    </div>

    <!-- Embedded Schema -->
    <script>
        window.EMBEDDED_SCHEMA = {
            "type": "object",
            "additionalProperties": false,
            "required": [],
            "properties": {
                "Users": {
                    "type": "array",
                    "description": "People involved in this experiment",
                    "items": {"type": "string"},
                    "minItems": 0
                },
                "Sample": {
                    "type": "object",
                    "properties": {
                        "Label": {"type": "string", "description": "Quick sample identifier"},
                        "Components": {
                            "type": "array",
                            "description": "Sample components (allows for multiple components)",
                            "items": {
                                "type": "object",
                                "properties": {
                                    "Name": {"type": "string", "description": "Molecule name"},
                                    "Concentration": {"type": "number", "minimum": 0},
                                    "Unit": {"enum": ["uM", "mM", "M", "mg/mL", "%w/v", "%v/v", "equiv"], "default": "uM", "type": "string"},
                                    "Isotopic labelling": {
                                        "enum": ["unlabelled", "15N", "13C", "13C,15N", "2H,13C,15N", "Ile-δ1-13CH3", "Leu/Val-13CH3", "ILV-13CH3", "ILV-13CH3,15N", "Met-13CH3", "Met-13CH3,15N", "ILVM-13CH3", "AILV-13CH3", "custom"],
                                        "type": "string",
                                        "description": "Type of isotopic labelling used"
                                    },
                                    "Custom labelling": {"type": "string", "description": "Custom labelling description if 'custom' is selected above"}
                                }
                            },
                            "minItems": 0
                        }
                    }
                },
                "Buffer": {
                    "type": "object",
                    "properties": {
                        "pH": {"type": ["number", "null"], "minimum": 0, "maximum": 14, "description": "Buffer pH"},
                        "Components": {
                            "type": "array",
                            "description": "Buffer components and their concentrations",
                            "items": {
                                "type": "object",
                                "properties": {
                                    "name": {"type": "string", "description": "Buffer component name (e.g., Tris-HCl, NaCl, EDTA)"},
                                    "Concentration": {"type": "number", "minimum": 0},
                                    "Unit": {"enum": ["uM", "mM", "M", "mg/mL", "%w/v", "%v/v", "$w/w"], "default": "mM", "type": "string"}
                                }
                            },
                            "minItems": 0
                        },
                        "Chemical shift reference": {"enum": ["none", "DSS", "TMS", "TSP"], "type": "string", "description": "Chemical shift reference compound"},
                        "Reference concentration": {"type": "number", "minimum": 0, "description": "Concentration of chemical shift reference"},
                        "Reference unit": {"enum": ["uM", "mM", "M", "mg/mL", "%w/v", "%v/v", "%w/w"], "default": "%w/v", "type": "string", "description": "Unit for reference concentration"},
                        "Solvent": {"enum": ["custom", "10% D2O", "100% D2O", "CDCl3", "D6-DMSO", "D4-Methanol"], "type": "string", "description": "Solvent composition"},
                        "Custom solvent": {"type": "string", "description": "Custom solvent description if 'custom' is selected above"}
                    },
                    "required": []
                },
                "NMR Tube": {
                    "type": "object",
                    "properties": {
                        "Sample Volume": {"type": "number", "minimum": 0, "description": "Sample volume in microliters (µL)"},
                        "Diameter": {"enum": ["1.7 mm", "3 mm", "5 mm"], "type": "string", "description": "NMR tube diameter"},
                        "Type": {"type": "string", "enum": ["regular", "shigemi", "shaped", "coaxial"], "description": "Type of NMR tube"},
                        "SampleJet Rack Position": {"type": "string", "pattern": "^([A-H][1-9][0-9]?|)$", "description": "Position in SampleJet rack (e.g., A3, G11)"},
                        "SampleJet Rack ID": {"type": "string", "description": "Identifier for the specific rack"}
                    }
                },
                "Laboratory Reference": {
                    "type": "object",
                    "description": "Cross-references for lab notebooks etc.",
                    "properties": {
                        "Labbook Entry": {"type": "string", "description": "Reference to laboratory notebook entry"},
                        "Experiment ID": {"type": "string", "description": "Local experiment identifier"}
                    }
                },
                "Notes": {"type": "string", "description": "Free text field for additional notes and observations"},
                "Metadata": {
                    "type": "object",
                    "description": "",
                    "properties": {
                        "created_timestamp": {"type": "string", "format": "date-time", "description": "ISO 8601 timestamp when this record was created"},
                        "modified_timestamp": {"type": "string", "format": "date-time", "description": "ISO 8601 timestamp when this record was last modified"},
                        "ejected_timestamp": {"type": "string", "format": "date-time", "description": "ISO 8601 timestamp when this sample was ejected"},
                        "schema_version": {"type": "string", "description": "Version of this schema used", "default": "0.0.1"}
                    }
                }
            }
        };
    </script>

    <!-- Scripts -->
    <script src="js/storage.js"></script>
    <script src="js/file-manager.js"></script>
    <script src="js/schema-handler.js"></script>
    <script src="js/app.js"></script>
</body>
</html>